<!DOCTYPE HTML PUBLIC>
<html>
<head>
    <title>Properties</title>
</head>
<body>
</body>

<script src="species.min.js"></script>
<script src="underscore-min.js"></script>
<script>
    console.log('<b>/*--- PROPERTIES ---*/</b>');
</script>
<script id="properties">


    var Model = Species.Class({
        UID : {
            get : function() {
                if(this.__uid) {
                    return this.__uid;
                } else {
                    function S4() { return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1); }
                    this.__uid = (S4() + S4() + S4() + S4()  + S4()  + S4() + S4() + S4());
                    return this.__uid;
                }

            },
            set : function(value) { this.__uid = value; }
        },

        initialize : function _Model(){

        }
    });

    var ModelHelper = Species.Class({

        Model : {},
        //Models : {},

        initialize : function _ModelHelper() {
            this.Models = {};
        },

        save : function(model) {
            //Calling getter UID
            model.UID;
            console.log('saving ... ' + JSON.stringify(model));
        },

        clone : function(o) {
            var tmpo = Object.create(o), m;
            for(m in tmpo) { tmpo[m] = o[m]; }
            tmpo.UID = "";
            return tmpo;
        },

        getAll : function() { return _.toArray(this.Models); },

        each : function(cll, cbk) {
            _.toArray(this.Models).forEach(cll);
        },

        get : function(id) { return this.Models[id]; },

        add : function(model) {
            if(typeof model == 'object' && model.length != undefined) {
                var i;
                for(i = 0; i < model.length; i+=1){
                    if(model[i].isInstanceOf(this.Model)){
                        //this.Models.push({ Id : model[i].Id, Model : model[i]});
                        this.Models[model[i].Id] = model[i];
                    } else {
                        throw "Error : add " + model[i].typeName + " instead of " + this.Model.typeName;
                    }                    
                }
            } else {
                if(model.isInstanceOf(this.Model)){
                    //this.Models.push({ Id : model.Id, Model : model});
                    this.Models[model.Id] = model;
                } else {
                    throw "Error : add " + model.typeName + " instead of " + this.Model.typeName;
                }

            }
        }

    });


    var Supplier = Species.Class({
        Extends : Model,

        Name : {
            get : function() { return this.name; },
            set : function(value) { this.name = value; }
        },

        initialize : function _Supplier(name){
            console.log(this.UID);
            this.name = name;
        }
    });

    var Customer = Species.Class({
        Extends : Model,

        Id : {
            get : function() { return this.id; },
            set : function(value) { this.id = value; }
        },

        Name : {
            get : function() { return this.name; },
            set : function(value) { this.name = value; }
        },

        Budget : {
            get : function() { return this.budget; },
            set : function(value) { this.budget = value; }
        },

        initialize : function _Customer(id, name, budget){
            console.log(this.UID);
            this.name = name;
            this.id = id;
            this.budget  = budget;
        }
    });

    var Customers = Species.Class({
        Extends : ModelHelper,
        Model : Customer
        /*initialize : function _CustomerHelper() {
            ClientHelper.parent.initialize.call(this); // mandatory if override parent constructor
        }*/
    });

    var customers = Customers.New();
    var SecondCustomerHelper = Customers.New();

    var toto = Customer.New("001", "TOTO", 45000);
    var tutu = Customer.New("002", "TUTU", 3000);
    var tata = customers.clone(tutu);
    tata.Id = "003";

    customers.save(toto);
    customers.save(tutu);
    customers.save(tata);

    customers.add([toto, tutu, tata]);


    customers.getAll().forEach(function(e) { console.log( e.Id, e.Name, e.Budget); } );

    customers.each(function(e) { console.log( e.Id, e.Name, e.Budget); } )






</script>

</html>